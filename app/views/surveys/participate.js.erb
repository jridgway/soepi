$('#require-pin, #new-participant').remove();
<% if @survey.launched? %>
  <% if current_participant %>
    <% if not @participant_survey or @participant_survey.complete? %>
      window.onbeforeunload = null;
      $('body').append("<%= escape_javascript(render(:partial => '/surveys/complete')) %>");
      $('#completed').dialog({modal:true, height:225, width:450});
      if($('#question-slider').length > 0) {
        $('#question-slider').remove();
        $('#question-slider .inner').remove();
        $('#header').show('blind');
        $('#breadcrumbs').show('blind');
        $('#content-top').show('blind');
        $('#body_content').show('blind');
        $('#body_content_left').show('blind');
        $('#body_content_right').show('blind');
        $('#menu-footer').show('blind');
        $('#footer').show('blind');
        $('#uservoice-feedback').show('blind');
        $('#participate').show('blind');
      }
    <% else %>
      if($('#question-slider').length == 0) {
        $('#container').append("<%= escape_javascript(render(:partial => '/surveys/question_slider')) %>");
      }
      if($('#question-slider .inner .question').length > 0) {
        $('#question-slider .inner .question').hide('slide', function() {
          $(this).remove();
        });
        function next_question() {
          $('#question-slider .inner').html("<%= escape_javascript(render(:partial => '/surveys/question')) %>");
          $('#question-slider .inner .question').show('slide', {direction:'right'});
          $('#percent-complete').html("<%= escape_javascript(render(:partial => '/surveys/percent_complete')) %>");
          init_common_elements();
          init_form_tips();
          init_form_errors($('.new_participant_response .input'));
        }
        setTimeout('next_question();', 200);
      } else {
        $('#question-slider .inner').html("<%= escape_javascript(render(:partial => '/surveys/question')) %>");
        $('#question-slider .inner .question').show('blind');
        init_common_elements();
        init_form_tips();
        init_form_errors($('.new_participant_response .input'));
      }
      if($('#header').is(':visible')) {
        window.onbeforeunload = function(){return 'Are you sure you want to leave this survey?'};
        $('#header').hide('blind');
        $('#breadcrumbs').hide('blind');
        $('#content-top').hide('blind');
        $('#body_content').hide('blind');
        $('#body_content_left').hide('blind');
        $('#body_content_right').hide('blind');
        $('#menu-footer').hide('blind');
        $('#uservoice-feedback').hide('blind');
      }
    <% end %>
  <% else %>
    $('body').append("<%= escape_javascript(render(:partial => '/surveys/require_pin')) %>");
    $('#require-pin').dialog({modal:true, height:300, width:520, close: function(){$('.error2').qtip('destroy');}});
    init_form_tips();
    init_form_errors($('#require-pin .input'));
  <% end %>
<% else %>
  alert('We\'re sorry, this survey is no longer open for participation.');
<% end %>
init_common_elements();
